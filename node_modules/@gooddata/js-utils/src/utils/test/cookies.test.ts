// (C) 2007-2018 GoodData Corporation
import { syncCookieWithBootstrap } from '../cookies';

describe('cookies', () => {
    const EN = 'en-US';
    const DE = 'de-DE';
    const localeDefault = EN;
    const localeKeys = [EN, DE];

    const getBootstrapDataWithLocale = (language: string) => ({
        bootstrapResource: {
            accountSetting: {
                language
            }
        }
    });

    const bootstrapEn = getBootstrapDataWithLocale(EN);

    it('should not set cookie if cookies not enabled', () => {
        const spySet = jest.fn();
        syncCookieWithBootstrap(bootstrapEn, localeKeys, localeDefault, {
            getLocaleCookie: (): any => null,
            setLocaleCookie: spySet,
            cookiesEnabled: () => false
        });

        expect(spySet).not.toHaveBeenCalled();
    });

    it('should not set cookie if locale in cookie the same as in bootstrap data', () => {
        const spySet = jest.fn();
        syncCookieWithBootstrap(bootstrapEn, localeKeys, localeDefault, {
            getLocaleCookie: () => EN,
            setLocaleCookie: spySet,
            cookiesEnabled: () => true
        });

        expect(spySet).not.toHaveBeenCalled();
    });

    it('should set cookie if cookies enabled and cookie different than bootstrap', () => {
        const spySet = jest.fn();
        syncCookieWithBootstrap(bootstrapEn, localeKeys, localeDefault, {
            getLocaleCookie: () => DE,
            setLocaleCookie: spySet,
            cookiesEnabled: () => true
        });

        expect(spySet).toHaveBeenCalledWith(EN);
    });
});
