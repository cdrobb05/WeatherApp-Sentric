// (C) 2020-2021 GoodData Corporation
const FREE = 'free';
const GROWTH = 'growth';

export interface IFeatureFlags {
    [key: string]: number | boolean | string;
}

export function shouldHidePPExperience(featureFlags: IFeatureFlags): boolean {
    const hidePPExperience = featureFlags.hidePixelPerfectExperience as boolean;
    const enablePPExperience = featureFlags.enablePixelPerfectExperience as boolean;
    const platformEdition = featureFlags.platformEdition as string;
    const isFreemiumUser = isFreemiumEdition(platformEdition);

    return hidePPExperience || (isFreemiumUser && !enablePPExperience);
}

export function isFreemiumEdition(platformEdition: string): boolean {
    return platformEdition === FREE || platformEdition === GROWTH;
}

export function shouldEnableNewNavigation(
    featureFlags: IFeatureFlags
): boolean {
    const enableNewNavigationForResponsiveUi = featureFlags.enableNewNavigationForResponsiveUi as boolean;
    if (enableNewNavigationForResponsiveUi) {
        const platformEdition = featureFlags.platformEdition as string;

        // Free: always true
        if (platformEdition === FREE) {
            return true;
        }

        // Growth/Enterprise: with PP: false, without PP: On demand
        return shouldHidePPExperience(featureFlags);
    }

    return false;
}
